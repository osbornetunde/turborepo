"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getNpmPackageImportPath = exports.getNpmPackageName = exports.isNpmPackageName = exports.isNpmPackageImport = void 0;
const assert_1 = require("./assert");
const invalidNameRE = /[^a-zA-Z-_]/;
function isNpmPackageImport(str) {
    const res = parseNpmPath(str);
    return res !== null;
}
exports.isNpmPackageImport = isNpmPackageImport;
function isNpmPackageName(str) {
    const res = parseNpmPath(str);
    return res !== null && res.importPath === null;
}
exports.isNpmPackageName = isNpmPackageName;
function getNpmPackageName(str) {
    const res = parseNpmPath(str);
    if (!res)
        return null;
    return res.npmPackageName;
}
exports.getNpmPackageName = getNpmPackageName;
function getNpmPackageImportPath(str) {
    const res = parseNpmPath(str);
    if (!res)
        return null;
    return res.importPath;
}
exports.getNpmPackageImportPath = getNpmPackageImportPath;
function parseNpmPath(str) {
    if (str === undefined || str.includes('\\') || str.startsWith('/')) {
        return null;
    }
    let scope = null;
    if (str.startsWith('@')) {
        if (!str.includes('/')) {
            return null;
        }
        const [first, ...rest] = str.split('/');
        scope = first;
        str = rest.join('/');
        (0, assert_1.assert)(scope && scope.startsWith('@'));
    }
    if (str === '') {
        return null;
    }
    const [first, ...rest] = str.split('/');
    const name = first;
    const importPath = rest.length === 0 ? null : rest.join('/');
    (0, assert_1.assert)(name);
    (0, assert_1.assert)(importPath === null || !importPath.startsWith('/'));
    if (invalidNameRE.test(name) || (scope && invalidNameRE.test(scope.slice(1)))) {
        return null;
    }
    (0, assert_1.assert)(!name.startsWith('/'));
    const npmPackageName = scope ? `${scope}/${name}` : name;
    return {
        npmPackageName,
        importPath
    };
}
