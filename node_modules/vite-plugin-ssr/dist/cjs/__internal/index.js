"use strict";
// Internal functions of vps needed by other plugins are exported via this file
Object.defineProperty(exports, "__esModule", { value: true });
exports.getPagesAndRoutes = exports.route = void 0;
const route_1 = require("../shared/route");
Object.defineProperty(exports, "route", { enumerable: true, get: function () { return route_1.route; } });
const getPageFiles_1 = require("../shared/getPageFiles");
const globalContext_1 = require("../node/runtime/globalContext");
const nodeEnv_1 = require("../utils/nodeEnv");
/**
 * Used by {@link https://github.com/magne4000/vite-plugin-vercel|vite-plugin-vercel}
 * to compute some rewrite rules and extract { isr } configs.
 * Needs `import 'vite-plugin-ssr/__internal/setup'`
 * @param config
 */
async function getPagesAndRoutes() {
    (0, nodeEnv_1.setNodeEnvToProduction)();
    await (0, globalContext_1.initGlobalContext)({ isPrerendering: true });
    (0, globalContext_1.getGlobalContext)();
    const { pageFilesAll, pageConfigs, allPageIds, pageConfigGlobal } = await (0, getPageFiles_1.getPageFilesAll)(false, true);
    const { pageRoutes } = await (0, route_1.loadPageRoutes)(pageFilesAll, pageConfigs, pageConfigGlobal, allPageIds);
    return {
        pageRoutes,
        pageFilesAll,
        pageConfigs,
        allPageIds
    };
}
exports.getPagesAndRoutes = getPagesAndRoutes;
