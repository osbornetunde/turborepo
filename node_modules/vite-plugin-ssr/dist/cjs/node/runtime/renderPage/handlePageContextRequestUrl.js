"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handlePageContextRequestUrl = void 0;
const getPageContextRequestUrl_1 = require("../../../shared/getPageContextRequestUrl");
const utils_1 = require("../utils");
// See shared/getPageContextRequestUrl.ts
function handlePageContextRequestUrl(url) {
    if (!hasSuffix(url)) {
        return { urlWithoutPageContextRequestSuffix: url, isPageContextRequest: false };
    }
    return { urlWithoutPageContextRequestSuffix: removePageContextUrlSuffix(url), isPageContextRequest: true };
}
exports.handlePageContextRequestUrl = handlePageContextRequestUrl;
function hasSuffix(url) {
    const { pathnameOriginal, pathname } = (0, utils_1.parseUrl)(url, utils_1.baseServer);
    (0, utils_1.assert)(pathnameOriginal.endsWith(getPageContextRequestUrl_1.fileExtension) === pathname.endsWith(getPageContextRequestUrl_1.fileExtension), { url });
    return pathnameOriginal.endsWith(getPageContextRequestUrl_1.fileExtension);
}
function removePageContextUrlSuffix(url) {
    const urlParsed = (0, utils_1.parseUrl)(url, utils_1.baseServer);
    // We cannot use `urlParsed.pathname` because it would break the `urlParsed.pathnameOriginal` value of subsequent `parseUrl()` calls.
    const { origin, pathnameOriginal, searchOriginal, hashOriginal } = urlParsed;
    (0, utils_1.assert)(getPageContextRequestUrl_1.doNotCreateExtraDirectory === false);
    const urlSuffix = `/index${getPageContextRequestUrl_1.fileExtension}`;
    (0, utils_1.assert)(pathnameOriginal.endsWith(urlSuffix), { url });
    let pathnameModified = (0, utils_1.slice)(pathnameOriginal, 0, -1 * urlSuffix.length);
    if (pathnameModified === '')
        pathnameModified = '/';
    (0, utils_1.assert)(url === `${origin || ''}${pathnameOriginal}${searchOriginal || ''}${hashOriginal || ''}`, { url });
    return `${origin || ''}${pathnameModified}${searchOriginal || ''}${hashOriginal || ''}`;
}
