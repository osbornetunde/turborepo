"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.executeOnBeforeRenderHooks = void 0;
const getHook_1 = require("../../../shared/getHook");
const preparePageContextForRelease_1 = require("./preparePageContextForRelease");
const utils_1 = require("../utils");
const assertOnBeforeRenderHookReturn_1 = require("../../../shared/assertOnBeforeRenderHookReturn");
async function executeOnBeforeRenderHooks(pageContext) {
    if (pageContext._pageContextAlreadyProvidedByOnPrerenderHook) {
        return;
    }
    const hook = (0, getHook_1.getHook)(pageContext, 'onBeforeRender');
    if (!hook) {
        return;
    }
    const onBeforeRender = hook.hookFn;
    (0, preparePageContextForRelease_1.preparePageContextForRelease)(pageContext);
    const hookResult = await (0, utils_1.callHookWithTimeout)(() => onBeforeRender(pageContext), 'onBeforeRender', hook.hookFilePath);
    (0, assertOnBeforeRenderHookReturn_1.assertOnBeforeRenderHookReturn)(hookResult, hook.hookFilePath);
    const pageContextFromHook = hookResult?.pageContext;
    Object.assign(pageContext, pageContextFromHook);
}
exports.executeOnBeforeRenderHooks = executeOnBeforeRenderHooks;
